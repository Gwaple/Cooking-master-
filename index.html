<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChefMaster: Next-Gen Cooking Game</title>
  <meta name="viewport" content="width=500, initial-scale=1">
  <style>
    html,body { margin:0;padding:0;background:#352a26;}
    body { font-family: 'Segoe UI', Arial, sans-serif; }
    #chef-home, #chef-auth { transition: opacity .3s; }
    #chef-userbar {
      position:absolute;top:10px;left:10px;z-index:10;display:none;
      font-size:1.08em;background:rgba(255,255,255,0.94);
      padding:8px 22px 8px 16px;border-radius:18px;box-shadow:0 1px 8px #ccc;}
    #chef-userbar button { margin-left:12px;background:#ffeaea;border:1px solid #fdc7c7;border-radius:6px;color:#b22222;cursor:pointer;}
    #chef-app-canvas {
      display:block;margin:60px auto 0 auto;background:#fffbe9;box-shadow:0 5px 36px #0007;border-radius:18px;
    }
    .chef-btn {
      background:#fb8c00;color:#fff;font-weight:bold;font-size:1.1em;border:none;
      border-radius:10px;padding:12px 36px;box-shadow:0 2px 16px #fb8c00aa;cursor:pointer;
      transition:background .2s;
    }
    .chef-btn:hover { background:#ffb300; color:#a64b00;}
    .chef-input { width:90%;margin-bottom:10px;padding:9px;font-size:1.12em;border-radius:7px;border:1px solid #ccc;}
    #chef-app-sidequests {
      position:absolute;top:90px;right:5vw;width:170px;background:rgba(255,255,255,0.95);
      border-radius:14px; box-shadow:0 2px 18px #c96c1c3b; padding:14px 12px; display:none;
      font-size:1.1em; color:#a64b00;
    }
  </style>
</head>
<body>
<!-- HOMEPAGE -->
<div id="chef-home" style="display:flex;position:fixed;z-index:11;left:0;top:0;width:100vw;height:100vh;align-items:center;justify-content:center;background:#352a26;">
  <div style="background:rgba(255,243,222,0.98);border-radius:26px;padding:38px 36px;min-width:320px;max-width:430px;text-align:center;box-shadow:0 8px 60px #c96c1c;">
    <canvas id="chef-home-anim" width="320" height="170" style="display:block;margin:auto;margin-bottom:14px;border-radius:16px;"></canvas>
    <h1 style="color:#fb8c00;font-family:Arial Black,Arial,sans-serif;font-size:2.1em;letter-spacing:2px;margin:0 0 14px 0;text-shadow:0 3px 12px #fffbe9,0 1px 0 #c96c1c;">CHEFMASTER</h1>
    <div style="color:#533c28;font-size:1.09em;margin-bottom:18px;">
      <p>Master chef challenge!<br>Unlock recipes, conquer side quests,<br>and become a culinary legend.</p>
    </div>
    <button onclick="chefGoToLogin()" class="chef-btn">Sign In / Register</button>
    <div style="margin-top:20px;font-size:.98em;color:#b66a00;">By Gwaple</div>
  </div>
</div>
<!-- LOGIN/REGISTER OVERLAY -->
<div id="chef-auth" style="display:none;position:fixed;z-index:12;left:0;top:0;width:100vw;height:100vh;align-items:center;justify-content:center;background:rgba(56,42,38,0.85);">
  <div id="chef-login-box" style="background:#fffbe9;border-radius:15px;box-shadow:0 2px 24px #b66a00;padding:30px 28px 22px 28px;min-width:240px;max-width:330px;">
    <h2 style="margin-top:0;text-align:center;color:#fb8c00;">Sign In</h2>
    <input id="chef-login-user" class="chef-input" placeholder="Username"><br>
    <input id="chef-login-pass" type="password" class="chef-input" placeholder="Password"><br>
    <button onclick="chefLogin()" class="chef-btn" style="width:90%;">Sign In</button>
    <button onclick="chefShowRegister()" class="chef-btn" style="width:90%;margin-top:6px;background:#fffbe9;color:#fb8c00;border:1px solid #fb8c00;">Register</button>
    <button onclick="chefGoHome()" class="chef-btn" style="width:90%;margin-top:6px;background:#fff;color:#382a26;border:1px solid #c96c1c;">Home</button>
    <div id="chef-login-msg" style="min-height:18px;margin-top:10px;color:#ff6060;"></div>
  </div>
  <div id="chef-register-box" style="display:none;background:#fffbe9;border-radius:15px;box-shadow:0 2px 24px #b66a00;padding:30px 28px 22px 28px;min-width:240px;max-width:330px;">
    <h2 style="margin-top:0;text-align:center;color:#fb8c00;">Register</h2>
    <input id="chef-reg-user" class="chef-input" placeholder="Username"><br>
    <input id="chef-reg-pass" type="password" class="chef-input" placeholder="Password"><br>
    <button onclick="chefRegister()" class="chef-btn" style="width:90%;">Register</button>
    <button onclick="chefShowLogin()" class="chef-btn" style="width:90%;margin-top:6px;background:#fffbe9;color:#fb8c00;border:1px solid #fb8c00;">Back</button>
    <button onclick="chefGoHome()" class="chef-btn" style="width:90%;margin-top:6px;background:#fff;color:#382a26;border:1px solid #c96c1c;">Home</button>
    <div id="chef-register-msg" style="min-height:18px;margin-top:10px;color:#8dff6e;"></div>
  </div>
</div>
<!-- USERBAR -->
<div id="chef-userbar">
  <span id="chef-userbar-welcome"></span>
  <button onclick="chefLogout()">Logout</button>
</div>
<!-- SIDE QUESTS -->
<div id="chef-app-sidequests"></div>
<!-- MAIN APP CANVAS -->
<canvas id="chef-app-canvas" width="480" height="680"></canvas>
<script>
// --- High-effort animated homepage: Chef, flying food, kitchen vibe, more ---
function chefAnimHomepage() {
  const c = document.getElementById('chef-home-anim');
  if (!c) return;
  const ctx = c.getContext('2d');
  let t = 0, food = [
    {img:"🥕",x:40,y:110,dx:1.5,dy:0.5,rot:0,dr:0.01},
    {img:"🥩",x:250,y:120,dx:-2.1,dy:0.6,rot:0,dr:-0.012},
    {img:"🍳",x:160,y:40,dx:0.8,dy:1.2,rot:0,dr:0.019},
    {img:"🥦",x:80,y:60,dx:1.2,dy:1.3,rot:0,dr:0.01},
    {img:"🧀",x:90,y:150,dx:1.1,dy:-0.7,rot:0,dr:0.009}
  ];
  let bubbles = Array.from({length:16},()=>({x:Math.random()*320,y:170+Math.random()*40,dy:-0.7-Math.random()*0.2,r:4+Math.random()*7,alpha:Math.random()*0.6+0.3}));
  function drawChef(x,y) {
    ctx.save(); ctx.translate(x,y);
    // Shadow
    ctx.globalAlpha=0.13;
    ctx.beginPath(); ctx.ellipse(0,56,30,7,0,0,2*Math.PI); ctx.fillStyle="#000"; ctx.fill();
    ctx.globalAlpha=1;
    // Apron/body
    ctx.fillStyle="#fff"; ctx.beginPath(); ctx.ellipse(0,30,26,36,0,0,2*Math.PI); ctx.fill();
    ctx.fillStyle="#fb8c00"; ctx.beginPath(); ctx.ellipse(0,56,20,14,0,0,2*Math.PI); ctx.fill();
    // Head
    ctx.beginPath(); ctx.arc(0,0,22,0,2*Math.PI); ctx.fillStyle="#f0c4a2"; ctx.fill();
    // Smile
    ctx.beginPath(); ctx.arc(0,7,7,0,Math.PI,false); ctx.strokeStyle="#a44"; ctx.lineWidth=2; ctx.stroke();
    // Eyes
    ctx.beginPath(); ctx.arc(-7,-5,3,0,2*Math.PI); ctx.arc(7,-5,3,0,2*Math.PI); ctx.fillStyle="#333"; ctx.fill();
    // Hat base
    ctx.beginPath(); ctx.ellipse(0,-16,19,8,0,0,2*Math.PI); ctx.fillStyle="#fff"; ctx.fill();
    // Hat top
    ctx.beginPath(); ctx.ellipse(0,-28,15+Math.sin(t/21)*2,13,0,0,2*Math.PI); ctx.fill();
    ctx.restore();
  }
  function draw() {
    ctx.clearRect(0,0,320,170);
    ctx.fillStyle="#fffbe9"; ctx.fillRect(0,0,320,170);
    // Table
    ctx.fillStyle="#f0c4a2"; ctx.fillRect(0,130,320,40);
    // Bubbles (side quest hint)
    for(let bub of bubbles){
      ctx.save(); ctx.globalAlpha=bub.alpha;
      ctx.beginPath(); ctx.arc(bub.x,bub.y,bub.r,0,2*Math.PI); ctx.fillStyle="#fb8c00"; ctx.fill();
      ctx.restore();
      bub.y += bub.dy; if(bub.y<120){bub.y=170+Math.random()*40;}
    }
    drawChef(80,100);
    // Flying food
    for(let f of food) {
      ctx.save();
      ctx.translate(f.x,f.y); ctx.rotate(f.rot);
      ctx.font="2em serif"; ctx.globalAlpha=0.93;
      ctx.fillText(f.img,0,0);
      ctx.restore();
      f.x += f.dx; f.y += f.dy; f.rot += f.dr;
      if (f.x<20||f.x>300){f.dx*=-1;}
      if (f.y<20||f.y>150){f.dy*=-1;}
    }
    ctx.font="bold 1.5em Arial";
    ctx.fillStyle="#fb8c00";
    ctx.fillText("Let's Cook!",190,60+Math.sin(t/12)*7);
    t++;
    requestAnimationFrame(draw);
  }
  draw();
}

// --- LOGIN/REGISTER/USER SYSTEM (with progress/recipes/sidequests per user) ---
let chefCurrentUser = "";
function chefUserKey(u){return 'chef-user-'+u;}
function chefProgressKey(u){return 'chef-progress-'+u;}
function chefSaveUser(u,p){localStorage.setItem(chefUserKey(u),JSON.stringify({password:p}));}
function chefGetUser(u){try{return JSON.parse(localStorage.getItem(chefUserKey(u)));}catch(e){return null;}}
function chefSetMsg(id,msg,ok){let el=document.getElementById(id);el.textContent=msg;el.style.color=ok?"#86ffae":"#ff6060";}
function chefLogin(){
  let u=document.getElementById('chef-login-user').value.trim(),p=document.getElementById('chef-login-pass').value;
  let user=chefGetUser(u);
  if(!u||!p)return chefSetMsg('chef-login-msg',"Enter username & password.");
  if(!user)return chefSetMsg('chef-login-msg',"User not found.");
  if(user.password!==p)return chefSetMsg('chef-login-msg',"Wrong password.");
  chefCurrentUser=u;
  document.getElementById('chef-auth').style.display="none";
  document.getElementById('chef-userbar-welcome').textContent="Hello, "+u+"!";
  document.getElementById('chef-userbar').style.display="";
  chefLoadProgress();
  chefOnLogin && chefOnLogin();
}
function chefRegister(){
  let u=document.getElementById('chef-reg-user').value.trim(),p=document.getElementById('chef-reg-pass').value;
  if(!u||!p)return chefSetMsg('chef-register-msg',"Enter username & password.",false);
  if(chefGetUser(u))return chefSetMsg('chef-register-msg',"User already exists.",false);
  chefSaveUser(u,p);chefSetMsg('chef-register-msg',"Registered! You can sign in now.",true);
}
function chefShowLogin(){
  document.getElementById('chef-login-box').style.display="";
  document.getElementById('chef-register-box').style.display="none";
  chefSetMsg('chef-login-msg',"",true);chefSetMsg('chef-register-msg',"",true);
}
function chefShowRegister(){
  document.getElementById('chef-login-box').style.display="none";
  document.getElementById('chef-register-box').style.display="";
  chefSetMsg('chef-login-msg',"",true);chefSetMsg('chef-register-msg',"",true);
}
function chefLogout(){
  chefCurrentUser="";document.getElementById('chef-userbar').style.display="none";
  document.getElementById('chef-auth').style.display="flex";chefShowLogin();chefOnLogout&&chefOnLogout();
}
function chefGoHome(){
  document.getElementById('chef-home').style.display="";
  document.getElementById('chef-auth').style.display="none";
  document.getElementById('chef-userbar').style.display="none";
  chefOnLogout&&chefOnLogout();
}
function chefGoToLogin(){
  document.getElementById('chef-home').style.display="none";
  document.getElementById('chef-auth').style.display="flex";
  chefShowLogin();
}

// --- PROGRESS SYSTEM (per user, recipes, side quests) ---
let chefProgress = {recipe:1, unlocked:[0], sidequests:[], completed:[]};
function chefSaveProgress(){if(chefCurrentUser)localStorage.setItem(chefProgressKey(chefCurrentUser),JSON.stringify(chefProgress));}
function chefLoadProgress(){
  if(chefCurrentUser){
    let p=localStorage.getItem(chefProgressKey(chefCurrentUser));
    chefProgress=p?JSON.parse(p):{recipe:1,unlocked:[0],sidequests:[],completed:[]};
  }
}

// --- RECIPES & SIDE QUESTS (Easy to expand) ---
const chefRecipes = [
  {name:"Veggie Omelette",emoji:["🍳","🥦","🥕"],steps:[
    {desc:"Crack eggs", type:"crack", n:2, anim:"egg"},
    {desc:"Chop carrot", type:"chop", n:3, anim:"carrot"},
    {desc:"Stir in pan", type:"stir", n:8, anim:"pan"},
    {desc:"Flip omelette", type:"flip", n:1, anim:"flip"}
  ]},
  {name:"Beef Burger",emoji:["🍔","🥩","🧀"],steps:[
    {desc:"Chop beef", type:"chop", n:4, anim:"beef"},
    {desc:"Shape patties", type:"shape", n:3, anim:"patty"},
    {desc:"Grill patties", type:"grill", n:5, anim:"grill"},
    {desc:"Assemble burger", type:"stack", n:1, anim:"burger"}
  ]},
  {name:"Pizza Margherita",emoji:["🍕","🧀","🍅"],steps:[
    {desc:"Knead dough", type:"knead", n:8, anim:"dough"},
    {desc:"Spread sauce", type:"spread", n:3, anim:"sauce"},
    {desc:"Sprinkle cheese", type:"sprinkle", n:5, anim:"cheese"},
    {desc:"Bake pizza", type:"bake", n:1, anim:"oven"}
  ]}
];
// Example sidequests (easy to expand)
const chefSideQuests = [
  {id:1,desc:"Cook 3 omelettes in a row!",req:{recipe:0, count:3}},
  {id:2,desc:"Finish a burger without dropping!",req:{recipe:1, noMistake:true}},
  {id:3,desc:"Unlock all recipes",req:{unlockAll:true}}
];

// --- INIT HOMEPAGE ---
window.addEventListener('DOMContentLoaded',function(){
  chefAnimHomepage();
  chefGoHome();
});

// --- INTEGRATION HOOKS ---
window.chefOnLogin = function() {
  chefDrawMainApp();
};
window.chefOnLogout = function() {
  chefClearMainApp();
};

// --- SIDEQUESTS UI ---
function chefDrawSideQuests() {
  let el=document.getElementById('chef-app-sidequests');
  el.style.display="block";
  let html = `<b>Side Quests</b><ul style="margin:6px 0 0 0;padding-left:18px;">`;
  for(let q of chefSideQuests) {
    let done = chefProgress.completed.includes(q.id);
    html += `<li style="color:${done?'#22a22a':'#a64b00'};">${done?"✓ ":""}${q.desc}</li>`;
  }
  html+="</ul>";
  el.innerHTML = html;
}

// --- MAIN GAME CANVAS/UI/ANIM CONTROLLER (MULTI-RECIPE, MINI-GAMES, SIDEQUESTS) ---
let chefGameState = { mode:"menu", recipe:0, step:0, progress:0, mistakes:0, repeatCount:0};
function chefDrawMainApp() {
  let c=document.getElementById('chef-app-canvas'),ctx=c.getContext('2d');
  chefDrawSideQuests();
  chefGameState = {mode:"menu",recipe:0,step:0,progress:0,mistakes:0,repeatCount:0};
  function menu() {
    ctx.clearRect(0,0,c.width,c.height);
    ctx.font="bold 2em Arial"; ctx.fillStyle="#fb8c00";
    ctx.fillText("Choose a Recipe!",90,60);
    chefRecipes.forEach((r,i)=>{
      let unlocked = chefProgress.unlocked.includes(i);
      ctx.globalAlpha = unlocked?1:0.35;
      ctx.fillStyle = unlocked?"#fb8c00":"#bbb";
      ctx.fillRect(60,120+90*i,360,70);
      ctx.globalAlpha = 1;
      ctx.font="1.6em Arial"; ctx.fillStyle="#a64b00";
      ctx.fillText(r.emoji.join(" ")+"  "+r.name, 90, 170+90*i);
      if(!unlocked) {
        ctx.font="1em Arial"; ctx.fillStyle="#c96c1c";
        ctx.fillText("Locked! Finish earlier recipes.", 120, 200+90*i);
      }
    });
    ctx.font="1em Arial"; ctx.fillStyle="#533c28";
    ctx.fillText("Progress: "+(chefProgress.unlocked.length)+"/"+chefRecipes.length+" recipes unlocked",95,400);
  }
  function startRecipe(i) {
    chefGameState={mode:"cook",recipe:i,step:0,progress:0,mistakes:0,repeatCount:0};
    chefDrawCookStep();
  }
  function menuClick(e) {
    let rect = c.getBoundingClientRect(), mx=e.clientX-rect.left, my=e.clientY-rect.top;
    chefRecipes.forEach((r,i)=>{
      let y=120+90*i;
      if(mx>60&&mx<420&&my>y&&my<y+70 && chefProgress.unlocked.includes(i)) {
        c.removeEventListener("mousedown",menuClick);
        startRecipe(i);
      }
    });
  }
  function unlockNextRecipe(){
    let next = chefGameState.recipe+1;
    if(next<chefRecipes.length && !chefProgress.unlocked.includes(next)) {
      chefProgress.unlocked.push(next); chefSaveProgress();
    }
  }
  function completeSideQuests(){
    for(let sq of chefSideQuests){
      if(chefProgress.completed.includes(sq.id)) continue;
      if(sq.req.recipe!==undefined){
        if(sq.req.recipe===chefGameState.recipe && chefGameState.repeatCount>=sq.req.count){chefProgress.completed.push(sq.id);}
        if(sq.req.recipe===chefGameState.recipe && sq.req.noMistake && chefGameState.mistakes===0){chefProgress.completed.push(sq.id);}
      }
      if(sq.req.unlockAll && chefProgress.unlocked.length===chefRecipes.length){chefProgress.completed.push(sq.id);}
    }
    chefSaveProgress();
    chefDrawSideQuests();
  }
  function chefDrawCookStep() {
    let g=chefGameState, r=chefRecipes[g.recipe], s=r.steps[g.step];
    ctx.clearRect(0,0,c.width,c.height);
    // BG
    ctx.fillStyle="#fffbe9"; ctx
